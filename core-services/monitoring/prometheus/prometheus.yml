# Prometheus Configuration for ALPR Monitoring Stack
# Scrapes metrics from all ALPR services and infrastructure

global:
  scrape_interval: 15s      # How often to scrape targets
  evaluation_interval: 15s  # How often to evaluate rules
  scrape_timeout: 10s       # Timeout for each scrape

  external_labels:
    cluster: 'alpr-production'
    environment: 'jetson-orin-nx'

# Scrape configurations
scrape_configs:
  # ALPR Pilot (Edge Processing)
  # Runs on host machine (Jetson), accessible via host.docker.internal
  - job_name: 'alpr-pilot'
    static_configs:
      - targets: ['host.docker.internal:8001']
    metrics_path: '/metrics'
    scrape_interval: 5s  # Scrape frequently for real-time FPS/latency metrics

  # Kafka Consumer (Storage Service)
  # Runs in Docker, accessible via service name
  - job_name: 'kafka-consumer'
    static_configs:
      - targets: ['kafka-consumer:8002']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Alert Engine (Notification Service)
  # Runs in Docker, accessible via service name
  - job_name: 'alert-engine'
    static_configs:
      - targets: ['alert-engine:8003']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Query API (REST API)
  # Runs in Docker, accessible via service name
  - job_name: 'query-api'
    static_configs:
      - targets: ['query-api:8000']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # cAdvisor (Container Metrics)
  # Provides CPU/RAM/network metrics for all Docker containers
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Prometheus Self-Monitoring
  # Monitor Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: '/metrics'
    scrape_interval: 30s

  # TimescaleDB Postgres Exporter (Optional - if enabled)
  # Uncomment if postgres_exporter is added to docker-compose
  # - job_name: 'timescaledb'
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']
  #   metrics_path: '/metrics'
  #   scrape_interval: 30s

  # Kafka Exporter (Optional - if enabled)
  # Uncomment if kafka_exporter is added to docker-compose
  # - job_name: 'kafka'
  #   static_configs:
  #     - targets: ['kafka-exporter:9308']
  #   metrics_path: '/metrics'
  #   scrape_interval: 30s
